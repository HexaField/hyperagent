#!/usr/bin/env bash
set -euo pipefail

COMMAND=${1:-}
shift || true

case "$COMMAND" in
  version|--version|-v)
    echo "opencode-mock 0.1.0"
    ;;
  run)
    PROMPT=${1:-}
    shift || true
    OUTPUT_DIR=${OPENCODE_LOG_DIR:-/tmp/opencode}
    mkdir -p "$OUTPUT_DIR"
    LOG_FILE="$OUTPUT_DIR/run-$(date +%s).json"
    cat <<JSON | tee "$LOG_FILE"
{
  "status": "done",
  "plan": "Execute prompt inside docker runner",
  "work": "Generated artifact for: ${PROMPT}",
  "requests": ""
}
JSON
    ;;
  *)
    echo "Usage: opencode <run|version>" >&2
    exit 1
    ;;
 esac
